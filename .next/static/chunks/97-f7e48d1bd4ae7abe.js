"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{7949:function(e,n,t){t.d(n,{u:function(){return o}});var r=t(5893),i=t(370);function o(e){var n=e.html,t=e.className;return(0,r.jsx)("div",{className:(0,i.A)("prose max-w-none",t),dangerouslySetInnerHTML:{__html:n}})}},7097:function(e,n,t){t.d(n,{c:function(){return M}});var r=t(4051),i=t.n(r),o=t(5893),a=t(7949),u=t(4952),l=t(159),s=t(370),c=t(5712),d=t(9238),f=t.n(d),p=t(7441),m=t(2620),g=t(4722);function v(e,n,t,r,i,o,a){try{var u=e[o](a),l=u.value}catch(s){return void t(s)}u.done?n(l):Promise.resolve(l).then(r,i)}function h(){var e,n,t=(e=["","",""],n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}})));return h=function(){return t},t}function y(e){return f().sanitize(p.TU.parse(e,{breaks:!0}))}function b(e,n,t){e.setText(e.getText().replace(n,t))}function x(e,n){var t=new g.CF(e),r=t.getCurrentPosition().lineNumber;n.forEach(function(){var e,n=(e=i().mark((function e(n,o){var a,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="![Uploading ".concat(n.name,"...]()"),t.spliceContent(g.CF.raw(h(),a,g.CF.$),{startLineNumber:r+o}),e.prev=2,e.next=5,(0,c.I)(n);case 5:u=e.sent,b(t,a,'<img width="'.concat(u.dpi>=144?Math.round(u.width/2):u.width,'" alt="').concat(u.originalFilename,'" src="').concat(u.url,'">')),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),b(t,a,""),m.ZP.error("Error uploading image: ".concat(e.t0.message));case 14:case"end":return e.stop()}}),e,null,[[2,9]])})),function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){v(o,r,i,a,u,"next",e)}function u(e){v(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())}var w=t(4245),j=t(6354),k=t(233),N=t(7294),O=t(9689),T=t(8767),E=t(6096),I=t(6496),A=t.n(I),P=t(8580);function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function S(e,n,t,r,i,o,a){try{var u=e[o](a),l=u.value}catch(s){return void t(s)}u.done?n(l):Promise.resolve(l).then(r,i)}function L(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){L(e,n,t[n])}))}return e}function D(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function U(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,o=[],a=!0,u=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);a=!0);}catch(l){u=!0,i=l}finally{try{a||null==t.return||t.return()}finally{if(u)throw i}}return o}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return _(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,n){switch(n.type){case"open":return{isOpen:!0,type:n.payload.type,position:n.payload.position,triggerIdx:n.payload.triggerIdx,query:n.payload.query};case"close":return{isOpen:!1,type:null,position:null,triggerIdx:null,query:""};case"updateQuery":return C({},e,{query:n.payload});default:throw new Error}}var R=[{commandTrigger:"bold",icon:(0,o.jsx)(u.mY,{className:"w-4 h-4"}),name:"Bold"},{commandTrigger:"italic",icon:(0,o.jsx)(u.h3,{className:"w-4 h-4"}),name:"Italic"},{commandTrigger:"unordered-list",icon:(0,o.jsx)(u.DE,{className:"w-4 h-4"}),name:"Unordered List"},{commandTrigger:"link",icon:(0,o.jsx)(u.xP,{className:"w-4 h-4"}),name:"Link"}];function B(e){var n=e.markdown;return(0,o.jsx)("div",{className:"pb-6 mt-8 border-b",children:n?(0,o.jsx)(a.u,{html:y(n)}):(0,o.jsx)("p",{children:"Nothing to preview"})})}function M(e){var n=function(){b({type:"close"})},t=e.label,r=e.value,i=e.minRows,a=void 0===i?15:i,u=e.onChange,c=e.onTriggerSubmit,d=D(e,["label","value","minRows","onChange","onTriggerSubmit"]),f=N.useRef(null),p=U(N.useState(!1),2),m=p[0],v=p[1],h=U(N.useReducer(q,{isOpen:!1,type:null,position:null,triggerIdx:null,query:""}),2),y=h[0],b=h[1];return(0,o.jsxs)("div",{children:[t&&(0,o.jsx)("label",{className:"block mb-2 font-semibold",children:t}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-center justify-between gap-4 px-4 py-px border rounded bg-primary",children:[(0,o.jsx)("div",{className:"flex gap-2 -ml-2",children:R.map((function(e){return(0,o.jsx)("button",{type:"button",onClick:function(){var n;null===(n=f.current)||void 0===n||n.trigger(e.commandTrigger)},className:(0,s.A)("rounded inline-flex items-center justify-center h-8 w-8 disabled:opacity-50 disabled:cursor-default focus:border focus-ring",!m&&"transition-colors hover:text-blue"),disabled:m,title:e.name,children:e.icon},e.commandTrigger)}))}),(0,o.jsxs)(j.r.Group,{as:"div",className:"flex items-center",children:[(0,o.jsx)(j.r,{checked:m,onChange:function(e){var n;!1===e&&(null===(n=f.current)||void 0===n||n.focus());v(e)},className:(0,s.A)(m?"bg-blue-500":"bg-gray-300 dark:bg-gray-700","relative inline-flex flex-shrink-0 items-center h-[18px] w-8 rounded-full transition-colors ease-in-out duration-200 focus-ring"),children:(0,o.jsx)("span",{className:(0,s.A)(m?"translate-x-4":"translate-x-0.5","inline-block w-3.5 h-3.5 transform bg-white dark:bg-gray-100 rounded-full transition-transform ease-in-out duration-200")})}),(0,o.jsx)(j.r.Label,{as:"span",className:"ml-2 text-xs cursor-pointer select-none",children:"Preview"})]})]}),(0,o.jsxs)("div",{className:(0,s.A)("mt-2 relative",m&&"sr-only"),children:[(0,o.jsx)(g.ZP.Wrapper,{ref:f,commands:[{name:"indent",enable:!1}],children:(0,o.jsx)(E.Z,C({},d,{value:r,onChange:function(e){u(e.target.value);var t=function(e){var n=e.selectionStart,t=e.value.slice(0,n),r=t.split(/\s/),i=r[r.length-1],o=t.endsWith(i)?t.length-i.length:-1,a=t[o],u="@"===a;return{keystrokeTriggered:u||":"===a,triggerIdx:o,type:u?"mention":"emoji",query:t.slice(o+1)}}(e.currentTarget),r=t.keystrokeTriggered,i=t.triggerIdx,o=t.type,a=t.query;if(r)if(y.isOpen)b({type:"updateQuery",payload:a});else{var l=A()(e.currentTarget,i+1);b({type:"open",payload:{type:o,position:{top:l.top+l.height,left:l.left},triggerIdx:i,query:a}})}else y.isOpen&&n()},onKeyDown:function(e){var n=e.code,t=e.metaKey;"Enter"===n&&t&&(null===c||void 0===c||c())},onPaste:function(e){if(l.h.NEXT_PUBLIC_ENABLE_IMAGE_UPLOAD){var n=Array.from(e.clipboardData.files);if(0===n.length)return;var t=n.filter((function(e){return/image/i.test(e.type)}));if(0===t.length)return;e.preventDefault(),x(e.currentTarget,t)}},onDrop:function(e){if(l.h.NEXT_PUBLIC_ENABLE_IMAGE_UPLOAD){var n=Array.from(e.dataTransfer.files);if(0===n.length)return;var t=n.filter((function(e){return/image/i.test(e.type)}));if(0===t.length)return;e.preventDefault(),x(e.currentTarget,t)}},className:"block w-full rounded shadow-sm bg-secondary border-secondary focus-ring",minRows:a}))}),(0,o.jsx)(F,{state:y,onSelect:function(e){var t,i=r.slice(0,y.triggerIdx),o=r.slice(null===(t=f.current)||void 0===t?void 0:t.selectionStart),a="";"mention"===y.type&&(a="[".concat(e.label,"](/profile/").concat(e.value,")")),"emoji"===y.type&&(a=e.value);var l="".concat(i).concat(a," ").concat(o);u(l),n(),setTimeout((function(){var e,n,t=l.length-o.length;null===(e=f.current)||void 0===e||e.focus(),null===(n=f.current)||void 0===n||n.setSelectionRange(t,t)}),0)},onClose:n})]}),m&&(0,o.jsx)(B,{markdown:r})]})]})}function F(e){var n,r=e.state,a=e.onSelect,u=e.onClose,l="mention"===r.type,s="emoji"===r.type,c=(0,T.useQuery)("emojiList",(n=i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.e(443).then(t.bind(t,791));case 2:return n=e.sent.gemoji,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){S(o,r,i,a,u,"next",e)}function u(e){S(o,r,i,a,u,"throw",e)}a(void 0)}))}),{enabled:r.isOpen&&s,staleTime:1/0}),d=w.S.useQuery(["user.mentionList"],{enabled:r.isOpen&&l,staleTime:3e5}),f=[];return l&&d.data&&(f=(0,k.Lu)(d.data,r.query,{keys:["name"]}).slice(0,5).map((function(e){return{label:e.name,value:e.id}}))),s&&c.data&&(f=(0,k.Lu)(c.data,r.query,{keys:["names","tags"],threshold:k.Lu.rankings.STARTS_WITH}).slice(0,5).map((function(e){return{label:"".concat(e.emoji," ").concat(e.names[0]),value:e.emoji}}))),r.isOpen&&r.position&&0!==f.length?(0,o.jsx)(G,{suggestionList:f,position:r.position,onSelect:a,onClose:u}):null}function G(e){var n=e.suggestionList,t=e.position,r=e.onSelect,i=e.onClose,a=(0,O.I)({onTriggered:i}),u=(0,P.k)({onSelect:function(e){r(e.value)}}),l=u.moveHighlightedItem,s=u.selectHighlightedItem,c=u.useItem;return N.useEffect((function(){var e=function(e){var n=e.code;["ArrowUp","ArrowDown","Enter","Tab"].includes(n)&&e.preventDefault(),"ArrowUp"===n&&l(-1),"ArrowDown"===n&&l(1),"Enter"!==n&&"Tab"!==n||s()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[l,s]),(0,o.jsx)("div",{ref:a,className:"absolute w-56 max-h-[286px] border rounded shadow-lg bg-primary overflow-y-auto",style:{top:t.top,left:t.left},children:(0,o.jsx)("ul",{role:"listbox",className:"divide-y divide-primary",children:n.map((function(e){return(0,o.jsx)(H,{useItem:c,suggestionResult:e},e.value)}))})})}function H(e){var n=e.useItem,t=e.suggestionResult,r=N.useRef(null),i=n({ref:r,value:t}),a=i.id,u=(i.index,i.highlight),l=i.select,c=(0,i.useHighlighted)();return(0,o.jsx)("li",{ref:r,id:a,onMouseEnter:u,onClick:l,role:"option","aria-selected":c?"true":"false",className:(0,s.A)("px-4 py-2 text-sm text-left transition-colors cursor-pointer ",c?"bg-blue-600 text-white":"text-primary"),children:t.label})}},159:function(e,n,t){t.d(n,{h:function(){return o}});var r=t(408),i=t(3454),o=(0,r.S7)({NEXT_PUBLIC_ENABLE_IMAGE_UPLOAD:(0,r.Xg)({input:i.env.NEXT_PUBLIC_ENABLE_IMAGE_UPLOAD,default:!1})})},5712:function(e,n,t){t.d(n,{I:function(){return u}});var r=t(4051),i=t.n(r);function o(e,n,t,r,i,o,a){try{var u=e[o](a),l=u.value}catch(s){return void t(s)}u.done?n(l):Promise.resolve(l).then(r,i)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function u(e){o(a,r,i,u,l,"next",e)}function l(e){o(a,r,i,u,l,"throw",e)}u(void 0)}))}}function u(e){return l.apply(this,arguments)}function l(){return(l=a(i().mark((function e(n){var t,r,o,a,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/sign-cloudinary",{method:"POST"});case 2:return t=e.sent,e.next=5,t.json();case 5:return r=e.sent,(o=new FormData).append("file",n),o.append("api_key",r.apiKey),o.append("timestamp",r.timestamp),o.append("signature",r.signature),o.append("folder",r.folder),o.append("image_metadata","true"),e.next=15,fetch("https://api.cloudinary.com/v1_1/".concat(r.cloudName,"/image/upload"),{method:"POST",body:o});case 15:return a=e.sent,e.next=18,a.json();case 18:if(!(u=e.sent).error){e.next=21;break}throw Error(u.error.message);case 21:return e.abrupt("return",{url:u.secure_url,originalFilename:u.original_filename,width:u.width,dpi:Number(u.image_metadata.DPI)});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);